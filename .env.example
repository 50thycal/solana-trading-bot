# ===============================================================================
# SOLANA SNIPER BOT CONFIGURATION
# ===============================================================================
# Copy this file to .env and fill in your values.
# Lines starting with # are comments and will be ignored.
# ===============================================================================

# ===============================================================================
# CORE CONFIGURATION (REQUIRED)
# ===============================================================================

# Your wallet's private key in base58 format
# IMPORTANT: Keep this secure and never commit to version control
PRIVATE_KEY=

# RPC Configuration (Helius recommended)
# Get your API key at: https://helius.dev
RPC_ENDPOINT=https://mainnet.helius-rpc.com/?api-key=YOUR_HELIUS_API_KEY
RPC_WEBSOCKET_ENDPOINT=wss://mainnet.helius-rpc.com/?api-key=YOUR_HELIUS_API_KEY

# Optional: Backup RPC endpoints (comma-separated) for failover
# These will be used if the primary endpoint fails
RPC_BACKUP_ENDPOINTS=

# Solana commitment level: processed | confirmed | finalized
# "confirmed" is recommended for balance of speed and reliability
COMMITMENT_LEVEL=confirmed

# ===============================================================================
# MODE CONFIGURATION
# ===============================================================================

# Bot operating mode - controls how the bot runs
# Options:
#   production  = Live trading with real transactions (default)
#   dry_run     = Paper trading - transactions logged but NOT executed
#   smoke       = End-to-end test: detect -> buy -> sell -> report, then exit
#   ab          = A/B paper trade comparison of two variant configs, then exit
#   standby     = Bot starts but does NOT connect to Solana or consume RPC credits.
#                 Health/dashboard server stays alive. Change to another mode and
#                 restart to resume.
#
# IMPORTANT: Start with dry_run to test your configuration safely
BOT_MODE=dry_run

# Log verbosity: trace | debug | info | warn | error
LOG_LEVEL=info

# ===============================================================================
# TRADING PARAMETERS
# ===============================================================================

# Token to use as quote currency (what you're spending)
# Options: WSOL, USDC, or a full token mint address
QUOTE_MINT=WSOL

# Amount to spend per trade (in quote token units)
# Example: 0.01 = 0.01 SOL per trade if QUOTE_MINT=WSOL
QUOTE_AMOUNT=0.01

# Slippage tolerance (percentage)
# Higher = more likely to execute but potentially worse price
BUY_SLIPPAGE=20
SELL_SLIPPAGE=30

# Delay before auto-buying after pool detection (milliseconds)
# 0 = buy immediately when filters pass
AUTO_BUY_DELAY=0

# Automatically sell when price targets are hit
AUTO_SELL=true

# Delay before checking for auto-sell (milliseconds)
AUTO_SELL_DELAY=0

# Process only one token at a time (prevents overexposure)
ONE_TOKEN_AT_A_TIME=true

# Take profit percentage (sell when price increases by this %)
TAKE_PROFIT=40

# Stop loss percentage (sell when price drops by this %)
STOP_LOSS=20

# Price monitoring settings
PRICE_CHECK_INTERVAL_SECONDS=2
PRICE_CHECK_DURATION_MINUTES=10

# ===============================================================================
# TRANSACTION EXECUTION
# ===============================================================================

# Executor type: default | warp | jito
# "jito" is recommended for MEV protection
TRANSACTION_EXECUTOR=jito

# Default executor settings (used when TRANSACTION_EXECUTOR=default)
COMPUTE_UNIT_LIMIT=101337
COMPUTE_UNIT_PRICE=421197

# Warp/Jito executor fee in SOL
CUSTOM_FEE=0.006

# Retry settings
MAX_BUY_RETRIES=10
MAX_SELL_RETRIES=10

# ===============================================================================
# OPERATIONAL SETTINGS
# ===============================================================================

# Health check server port
HEALTH_PORT=8080

# Directory for persistent data (SQLite database, logs, etc.)
DATA_DIR=./data

# ===============================================================================
# RISK CONTROLS
# ===============================================================================

# Maximum total SOL deployed across all open positions
# Bot will block new trades if this limit would be exceeded
MAX_TOTAL_EXPOSURE_SOL=0.5

# Maximum trades per hour (rolling window)
# Prevents rapid trading during volatile conditions
MAX_TRADES_PER_HOUR=10

# Minimum SOL to keep in wallet as buffer for gas/recovery
# Bot will not trade if balance would drop below this amount
MIN_WALLET_BUFFER_SOL=0.05

# Maximum time to hold a position in seconds (0 = disabled)
# When enabled, positions will be sold after this duration regardless of P&L
# Default: 20 (seconds). Set to 0 to disable.
MAX_HOLD_DURATION_SECONDS=20

# ===============================================================================
# EXECUTION QUALITY
# ===============================================================================

# Simulate transactions before sending (catches errors early, saves fees)
# Strongly recommended to keep enabled
SIMULATE_TRANSACTION=true

# Dynamic priority fee estimation (for default executor only)
# When enabled, queries recent network fees and uses configured percentile
USE_DYNAMIC_FEE=false

# Percentile of recent fees to use (0-100, higher = more aggressive)
PRIORITY_FEE_PERCENTILE=75

# Min/max bounds for dynamic priority fees (in microLamports)
MIN_PRIORITY_FEE=10000
MAX_PRIORITY_FEE=1000000

# Enable fallback executor (Jito -> Default RPC on failure)
# Only applies when TRANSACTION_EXECUTOR=jito
USE_FALLBACK_EXECUTOR=true

# Jito bundle confirmation settings (milliseconds)
# How long to wait for bundle to land before giving up
JITO_BUNDLE_TIMEOUT=60000

# How often to poll Jito for bundle status
JITO_BUNDLE_POLL_INTERVAL=2000

# ===============================================================================
# TOKEN AGE
# ===============================================================================

# Maximum age of a token (in seconds) to be considered "new"
# Tokens older than this will be rejected even if the pool is new
# This prevents buying into new pools for existing/old tokens
# Default: 300 (5 minutes)
# Recommended values:
#   - 120 (2 min): Conservative - only the freshest launches
#   - 300 (5 min): Standard - good balance of coverage and safety
#   - 600 (10 min): Aggressive - more launches, higher risk
MAX_TOKEN_AGE_SECONDS=300

# ===============================================================================
# PUMP.FUN FILTERS
# ===============================================================================
# Filter configuration specific to pump.fun bonding curve tokens.
# These filters evaluate the state of the bonding curve to determine
# if a token is worth buying. Designed for finding gems, not buying everything.

# Minimum SOL deposited in bonding curve to consider buying
# Tokens with less SOL haven't proven market interest yet
# Recommended: 5 (default) for some validation, 0 to disable
PUMPFUN_MIN_SOL_IN_CURVE=5

# Maximum SOL in bonding curve - avoids tokens near graduation (~400 SOL)
# Near-graduation tokens have less upside potential on the curve
# Recommended: 300 to catch early momentum, lower for earlier entries
PUMPFUN_MAX_SOL_IN_CURVE=300

# Enable/disable individual filters
# Min SOL filter: Requires minimum investment in curve (recommended)
PUMPFUN_ENABLE_MIN_SOL_FILTER=true

# Max SOL filter: Avoids near-graduation tokens
PUMPFUN_ENABLE_MAX_SOL_FILTER=true

# Minimum score required to buy (0-100)
# 0 = buy if all blocking filters pass (default)
# Higher values require better overall token quality score
# Future: Will be used when more scoring filters are added
PUMPFUN_MIN_SCORE_REQUIRED=0

# Detection cooldown: seconds to wait after accepting a token before accepting the next one.
# Tokens that arrive during the cooldown are silently dropped (no RPC calls made for them).
# This prevents concurrent transaction fetches from stacking up and hitting RPC rate limits.
# Set to 0 to disable (process every token). Set to ~10-15 to match your pipeline duration.
# Example: if your sniper gate takes 5-6s, a value of 10 gives the pipeline room to breathe.
PUMPFUN_DETECTION_COOLDOWN_SECONDS=0

# ===============================================================================
# MOMENTUM GATE (Pipeline Stage 4)
# ===============================================================================
# Validates buy momentum before allowing purchase.
# Uses retry-based polling to check if a token has sufficient buy transactions.
# Runs AFTER deep filters to minimize RPC usage (only tokens passing all
# previous gates are checked).

# Enable/disable the momentum gate
# When disabled, tokens pass through directly after deep filters
MOMENTUM_GATE_ENABLED=true

# Initial delay before first momentum check (in seconds)
# Allows time for first transactions to be indexed by RPC
# Default: 0.1 (100ms)
MOMENTUM_INITIAL_DELAY_SECONDS=0.1

# Minimum number of buy transactions required to pass
# Ensures multiple buyers have entered before we buy
# Default: 10
MOMENTUM_MIN_TOTAL_BUYS=10

# Wait time between recheck attempts (in seconds)
# If threshold not met, wait this long before checking again
# Default: 0.1 (100ms)
MOMENTUM_RECHECK_INTERVAL_SECONDS=0.1

# Maximum number of checks before rejecting
# Total max wait time = INITIAL_DELAY + (MAX_CHECKS * RECHECK_INTERVAL)
# Default: 5 (total window ~0.6 seconds with defaults)
MOMENTUM_MAX_CHECKS=5

# ===============================================================================
# SNIPER GATE (Pipeline Stage 4 - Alternative to Momentum Gate)
# ===============================================================================
# Identifies sniper bot wallets from early-slot buys, monitors for their
# exits (sells), then evaluates remaining organic demand. Buys only after
# bots have cleared out and real buyers remain.
#
# When enabled, this REPLACES the momentum gate at Stage 4.
# If both are enabled, sniper gate takes priority.
#
# RECOMMENDED: Start with LOG_ONLY=true to collect data before gating.

# Enable/disable the sniper gate
# Default: false
SNIPER_GATE_ENABLED=false

# Initial delay before first check (seconds)
# Allows time for first transactions to be indexed by RPC
# Default: 0.5
SNIPER_GATE_INITIAL_DELAY_SECONDS=0.5

# Wait time between recheck polls (seconds)
# Default: 1
SNIPER_GATE_RECHECK_INTERVAL_SECONDS=1

# Maximum number of checks before rejecting
# Total max window = INITIAL_DELAY + (MAX_CHECKS * RECHECK_INTERVAL)
# Each check issues 2 heavy RPC calls; keep this conservative to avoid rate limits.
# Default: 10 (~10.5s window with defaults)
SNIPER_GATE_MAX_CHECKS=10

# Slot threshold for classifying a wallet as a sniper bot
# Buys in slots 0 to N after token creation are flagged as bots
# Solana slots ~400ms each, threshold=3 means ~0-1.6 seconds after creation
# Default: 3
SNIPER_GATE_SNIPER_SLOT_THRESHOLD=3

# Minimum % of bot wallets that must have sold before we buy
# Higher = more conservative (wait for more bots to dump)
# Default: 50
SNIPER_GATE_MIN_BOT_EXIT_PERCENT=50

# Minimum unique organic buyer wallets (from later slots) required
# Default: 3
SNIPER_GATE_MIN_ORGANIC_BUYERS=3

# Log-only mode: compute all metrics but always pass the gate
# Use this to collect data before setting real thresholds
# Default: false
SNIPER_GATE_LOG_ONLY=false

# ===============================================================================
# TRAILING STOP LOSS
# ===============================================================================
# Replaces fixed take-profit with a trailing stop that locks in gains as
# price increases. When enabled, the fixed TAKE_PROFIT is ignored (use
# HARD_TAKE_PROFIT_PERCENT for a ceiling).
#
# How it works:
#   1. Track highest PnL % reached ("high water mark")
#   2. Trailing stop activates once PnL >= ACTIVATION_PERCENT
#   3. If PnL drops DISTANCE_PERCENT below the high water mark -> sell
#
# Example with defaults (activation=15, distance=10):
#   Entry -> +5%  (not active yet)
#   -> +20% (activates, trail at +10%)
#   -> +45% (new high water, trail at +35%)
#   -> +36% (above trail, hold)
#   -> +34% (below trail of +35%, SELL -> locked in ~34%)
#
# The existing STOP_LOSS still protects against drops before activation.

# Enable trailing stop loss (disables fixed TAKE_PROFIT when active)
# Default: false
TRAILING_STOP_ENABLED=false

# PnL % at which trailing stop activates
# Below this level, only the fixed STOP_LOSS protects downside
# Default: 15
TRAILING_STOP_ACTIVATION_PERCENT=15

# How far below the high water mark before selling (percentage points)
# Default: 10
TRAILING_STOP_DISTANCE_PERCENT=10

# Hard take profit ceiling (0 = disabled)
# If set, sells immediately at this level even with trailing stop active
# Default: 0 (disabled)
HARD_TAKE_PROFIT_PERCENT=0

# ===============================================================================
# SMOKE TEST (applies when BOT_MODE=smoke)
# ===============================================================================

# Timeout for smoke test mode in minutes
# How long the smoke test will wait for a token to pass the pipeline before giving up.
# Default: 5
SMOKE_TEST_TIMEOUT_MINUTES=5

# ===============================================================================
# LOG FORMAT
# ===============================================================================
# Controls Railway log output format.
# "pretty" = full pino-pretty with colors and details (default)
# "compact" = terse single-line format, no colors, easier to copy into Claude
# Default: pretty
LOG_FORMAT=pretty

# ===============================================================================
# PRODUCTION TIME LIMIT
# ===============================================================================
# Optional: Maximum duration for a production run in minutes.
# When set to a positive value, the bot will run for this duration then
# gracefully shut down (saving P&L data, closing positions, etc.).
# When set to 0 or left empty, the bot runs indefinitely (default behavior).
#
# Minimum: 1 minute when enabled.
#
# Examples:
#   60   = 1 hour
#   240  = 4 hours
#   480  = 8 hours
#   1440 = 24 hours
#
# Default: 0 (disabled - runs indefinitely)
PRODUCTION_TIME_LIMIT_MINUTES=0
